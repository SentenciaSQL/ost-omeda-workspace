<div class="chatbot-root">
  <!-- Header -->
  <div class="chatbot-header">
    <div class="header-top">
      <button class="collapse-btn" title="Collapse">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2.5">
          <path d="M13 17l5-5-5-5M6 17l5-5-5-5"/>
        </svg>
      </button>
      <span class="header-title">Omeda AI</span>
      <div class="header-right">
        <!-- Story 7: Connection indicator -->
        <span class="conn-dot" [class]="connectionStatus()" [title]="connectionStatus()"></span>
        <button class="new-chat-btn" title="New Chat" (click)="startNewChat()">âœ¦</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab" [class.active]="activeTab() === 'chat'"
              (click)="activeTab.set('chat')">Chat</button>
      <button class="tab" [class.active]="activeTab() === 'history'"
              (click)="activeTab.set('history')">
        Chat History
        @if (sessionsCount() > 0) {
          <span class="tab-badge">{{ sessionsCount() }}</span>
        }
      </button>
    </div>
  </div>

  <cb-connection-banner
    [status]="connectionStatus()"
    [retryAttempt]="retryAttempt()"
    [retryMax]="retryMaxAttempts()"
    [countdownMs]="retryCountdownMs()"
    [errorMessage]="connectionError()"
    (retryClicked)="onRetryConnection()"
  />

  <!-- Tab Content -->
  <div class="tab-content">
    @if (activeTab() === 'chat') {
      @if (!hasUserMessages()) {
        <cb-prompt-suggestions
          [prompts]="currentPrompts()"
          (selected)="onPromptSelected($event)"
        />
      }

      <cb-message-list
        [messages]="messages()"
        [isTyping]="isAgentTyping()"
        (confirmAction)="onActionConfirm($event)"
        (rejectAction)="onActionReject($event)"
      />

      <cb-chat-input
        [disabled]="isAgentTyping()"
        [showStartOver]="hasUserMessages()"
        (messageSent)="onUserMessage($event)"
        (startOver)="onStartOver()"
      />
    } @else {
      <cb-history-tab
        [sessions]="sessions()"
        [activeSessionId]="activeSessionId()"
        (loadSession)="onLoadSession($event)"
        (deleteSession)="onDeleteSession($event)"
      />
    }
  </div>
</div>
